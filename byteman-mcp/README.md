# Byteman MCP Server

A Model Context Protocol (MCP) server that provides tools for interacting with [Byteman](https://byteman.jboss.org/), a powerful tool for runtime modification of Java applications.

This project uses Quarkus, the Supersonic Subatomic Java Framework.

This is an example and not meant to be used in production!

## Overview

This MCP server exposes tools that allow LLMs and AI agents to:
- Submit Byteman scripts to running Java processes
- List installed Byteman rules
- Remove Byteman rules from processes

Byteman enables tracing, monitoring, and runtime modification of Java applications without requiring code changes or recompilation.

## Prerequisites

1. **Java 21** or higher
2. **Maven 3.8+** for building
3. **Target Java application** must be running with the Byteman agent attached

### Attaching Byteman Agent to Target Application

To use these tools, the target Java process must have the Byteman agent attached. You can do this in several ways:

#### Option 1: Start with agent
```bash
java -javaagent:/path/to/byteman.jar=port:9091 -jar your-app.jar
```

#### Option 2: Attach to running process
```bash
# Download Byteman if you don't have it
wget https://downloads.jboss.org/byteman/4.0.23/byteman-download-4.0.23-bin.zip
unzip byteman-download-4.0.23-bin.zip

# Attach to running process
cd byteman-download-4.0.23/bin
./bminstall.sh <PID>
```

## Available MCP Tools

### 1. `submitBytemanScript`

Submits a Byteman script to a running Java process.

**Example Byteman Script:**
```
RULE Trace method entry
CLASS com.example.MyClass
METHOD myMethod
AT ENTRY
IF true
DO traceln(">>> Entering myMethod")
ENDRULE
```

### 2. `listBytemanRules`

Lists all Byteman rules currently installed in a running Java process.

### 3. `removeAllBytemanRules`

Removes all Byteman rules from a running Java process.


### Example Usage

This is a very simple example that can monitor applications running on localhost and on port 9091.


* Build this project using `mvn clean install`

* Configure your favorite LLM client/agent to use your MCP by running the JAR that you just installed. You can use jbang for it. Here's the configuration for Claude Code client:

```
{
  "mcpServers": {
    "byteman": {
      "command": "jbang",
      "args": [
        "--quiet",
        "org.fxapps:byteman-mcp:0.1:runner"
      ]
    }
  }
}
```
* You should now be able to use the LLM client to submit generated Byteman scripts to Java applications running with Byteman on localhost. The MCP Server `BytemanMCPTool` can be improved for remote monitoring or even remote Byteman install (BE CAREFUL);

In this repo there's the `random.java` class that you can use for fun:

* Download byteman somewhere to your machine and make sure that the env var `BYTEMAN_HOME` points to the home directory of Byteman:

```
export BYTEMAN_HOME=/opt/byteman/byteman-download-4.0.26
```

* Using Java 21, you can run the class `random.java` with Byteman attached to it:

```
java -javaagent:${BYTEMAN_HOME}/lib/byteman.jar=listener:true --enable-preview random.java
```

* Now on your favorite LLM client you should be able to inject Byteman scripts into the running application:

{SCREENSHOT}